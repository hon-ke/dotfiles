# 博客同步客户端 (Blog Sync Client)

一个功能强大的博客内容同步工具，支持本地Markdown文档与远程博客系统的双向同步。

最主要实现的功能类似与`git`差不多，本地的md文档可以和远程博客实现双向同步，

```
docs/

├── 分类1/               # 文章分类目录
│   ├── 标签1/           # 文章标签目录
│   │   └── 文章1.md     # 拥有分类和标签的文章
│   └── 文章2.md         # 仅拥有分类的文章
├── 分类2/        
│   └── 文章3.md
├── 关于.md              # 页面文件 (必须在根目录)
└── 友链.md              # 页面文件 (必须在根目录)
```


只要一个 main.py push 就能将所有本地的结构推送到远程

## 功能特性

### 🔄 双向同步
- **推送 (Push)**: 将本地Markdown文档推送到远程博客
- **拉取 (Pull)**: 从远程博客拉取内容到本地
- **智能冲突处理**: 自动检测并处理本地与远程的内容差异

### 📁 文件管理
- **附件自动处理**: 自动上传/下载文章中的图片和附件
- **静态资源压缩**: 自动压缩图片文件以优化加载速度
- **文件清理**: 清理远程服务器上未使用的静态文件

### 🔧 高级功能
- **数据备份与恢复**: 完整的博客数据备份和恢复功能
- **冲突解决**: 多种冲突处理模式（显示/拉取/删除）
- **模板生成**: 快速创建文章和页面模板
- **示例文档**: 提供完整的示例文档结构

### 📊 日志系统
- 彩色终端输出，清晰显示操作状态
- 详细的进度信息和错误报告
- 支持显示/隐藏详细内容

## 快速开始

### 环境要求
- Python 3.7+
- 依赖包: `PyYAML`, `requests`

### 安装依赖
```bash
pip install -r requirements.txt
```

### 基本使用

1. **推送本地文档到远程**
```bash
python main.py push
```

2. **从远程拉取文档到本地**
```bash
python main.py pull
```

3. **创建示例文档结构**
```bash
python main.py example
```

4. **创建模板文档**
```bash
python main.py template
```

## 详细命令说明

### 核心命令

| 命令 | 说明 | 参数 |
|------|------|------|
| `push` | 推送本地文档到远程 | `--docs` 文档路径 (默认: docs) |
| `pull` | 从远程拉取文档到本地 | `--docs` 文档路径 (默认: docs) |
| `conflict` | 处理冲突文档 | `--docs` 文档路径, `--mode` 处理模式 |
| `clean` | 清理远程多余的静态文件 | 无 |
| `clear` | 清空远程所有内容 | 无 |
| `backup` | 备份远程数据 | `--backup_path` 备份目录 |
| `restore` | 从备份恢复数据 | `--backup_path` 备份目录 |
| `example` | 创建示例文档 | `--docs` 示例文档目录 |
| `template` | 创建模板文档 | `--docs` 模板文档目录 |

### 冲突处理模式

- `show` (默认): 仅显示冲突文档，不执行操作
- `pull`: 拉取远程有但本地没有的文档
- `delete`: 删除远程有但本地没有的文档

## 文档结构

### 本地文档目录结构
```
docs/
├── 关于.md              # 页面文件 (根目录)
├── 友链.md              # 页面文件 (根目录)
├── 分类1/               # 文章分类目录
│   ├── 标签1/           # 文章标签目录
│   │   └── 文章1.md
│   └── 文章2.md
└── 分类2/
    └── 文章3.md
```

### 文件类型说明

#### 页面文件 (Page)
- 位于文档根目录的Markdown文件
- 用于创建博客的静态页面（如关于、友链等）
- 支持YAML front matter元数据

#### 文章文件 (Post)
- 位于分类目录下的Markdown文件
- 支持多级分类和标签
- 自动从文件路径提取分类和标签信息

### YAML Front Matter 格式

#### 文章元数据
```yaml
---
title: 文章标题
category: 分类名称
tag: 标签名称
excerpt: 文章摘要
cover: 封面图片路径
is_top: false
is_locked: false
---
```

#### 页面元数据
```yaml
---
title: 页面标题
description: 页面描述
icon: 页面图标
is_active: true
order: 100
---
```

## 配置说明

### 服务器配置
在 `main.py` 文件中修改默认配置：
```python
config = {
    "base_url": "http://127.0.0.1:8000",  # 博客服务器地址
    "api_key": "123456"                    # API密钥
}
```

### 环境变量配置（推荐）
可以通过环境变量覆盖默认配置：
```bash
export BLOG_BASE_URL="https://your-blog.com"
export BLOG_API_KEY="your-api-key"
```

## 附件处理

### 支持的附件类型
- **图片**: `.jpg`, `.jpeg`, `.png`, `.gif`, `.webp`, `.bmp`
- **文档**: `.pdf`, `.doc`, `.docx`, `.txt`
- **压缩包**: `.zip`, `.rar`
- **视频**: `.mp4`, `.avi`, `.mov`

### 附件引用方式
工具会自动识别和处理以下格式的附件引用：

1. **Markdown图片**
   ```markdown
   ![图片描述](./images/photo.jpg)
   ```

2. **HTML图片**
   ```html
   <img src="./images/photo.jpg" alt="图片描述">
   ```

3. **文件链接**
   ```markdown
   [下载文件](./docs/manual.pdf)
   ```

## 错误处理

### 常见错误及解决方案

1. **连接失败**
   - 检查服务器地址和端口
   - 验证网络连接

2. **认证失败**
   - 检查API密钥是否正确
   - 确认用户权限

3. **文件不存在**
   - 检查文档路径是否正确
   - 确认文件权限

4. **冲突处理**
   - 使用 `conflict` 命令查看冲突详情
   - 选择合适的处理模式

## 开发指南

### 项目结构
```
client/
├── main.py          # 主程序入口，CLI接口
├── local.py         # 本地文档处理模块
├── remote.py        # 远程API客户端
├── requirements.txt # 项目依赖
└── README.md        # 项目文档
```

### 核心模块说明

#### `main.py`
- 命令行接口实现
- 主要工作流程控制
- 配置管理和错误处理

#### `local.py`
- 本地文档扫描和解析
- Front Matter元数据处理
- 附件提取和管理
- 文档模板生成

#### `remote.py`
- 远程API客户端
- 认证和授权管理
- 文件上传下载
- 数据备份恢复

### 扩展开发

#### 添加新的命令
在 `SimpleCLI` 类的 `_setup_commands` 方法中添加新的子命令解析器。

#### 自定义文档扫描规则
修改 `DocsScanner` 类中的文件过滤和解析逻辑。

#### 扩展API功能
在相应的API客户端类中添加新的方法。

## 最佳实践

### 工作流程
1. 使用 `example` 命令创建示例文档结构
2. 编辑本地Markdown文件
3. 使用 `push` 命令同步到远程
4. 定期使用 `backup` 命令备份数据

### 版本控制
- 将本地 `docs` 目录纳入版本控制
- 定期备份远程数据
- 使用冲突处理功能管理多人协作

### 性能优化
- 合理组织文档目录结构
- 使用适当的图片压缩
- 定期清理未使用的静态文件

## 许可证

本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

## 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目。

## 支持

如果遇到问题，请：
1. 查看本文档的常见问题部分
2. 检查日志输出中的错误信息
3. 提交 Issue 并提供详细的复现步骤
